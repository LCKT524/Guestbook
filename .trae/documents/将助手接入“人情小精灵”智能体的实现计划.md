## 当前状态
- 助手目前使用本地 `parseMessage` 做解析，并已实现“先播报、用户确认后保存”的流程。
- 未直接调用 IDE 中的“人情小精灵”智能体，因此与智能体的固定格式与智能提醒能力不完全一致。

## 目标
- 在应用中为助手接入“人情小精灵”智能体，让解析与播报遵循智能体规范；保持确认后再入库的交互。

## 技术方案
### 1) 代理桥（Agent Bridge）
- 新增 `src/lib/agentBridge.ts`，封装 `analyze(text)`：
  - 在开发环境：使用本地解析作为后备；
  - 在生产/IDE环境：调用“人情小精灵”智能体并返回结构化数据与播报文案。
- 返回结构：
  - `{ type, contact_name, amount, record_date, payment_method, note }` 与 `display`（播报文本）。

### 2) 助手页面改造
- `Assistant.tsx` 改用 `agentBridge.analyze(text)` 获取结果；
- 首次仅播报 `display`（示例：📌 新收入记录 ▸ 李娜 ▸ 金额：¥1200 ▸ 日期：[具体日期] ▸ 备注：），并提示回复【确认】才保存；
- 处理“未识别到金额”与其他异常提示（遵循智能体的异常文案）。

### 3) 入库逻辑
- 用户回复“确认”后，将待确认数据写入 Supabase `records`：
  - 统一使用 `record_date` 与 `note` 字段；
  - 若联系人不存在则先创建；
  - 保留分类（如有）与支付方式。

### 4) 兼容与兜底
- 智能体不可用时自动回退本地解析，保证核心流程可用；
- 两种路径均输出智能体规范格式的播报。

## 验收标准
- 任意收入语句输入，助手播报满足格式示例并要求确认；
- 回复【确认】后写库成功；
- 智能体不可用时，兜底解析与播报仍可用。

## 风险与处理
- 智能体接口不可用：回退本地解析；
- 返回非结构化：桥接层做解析与校验，必要时提示“未识别到金额”。

## 后续扩展（可选）
- 智能提醒与瀑布流查看记录按照智能体规范输出；
- 语句中含“回礼/随礼”等，自动识别收支类型与建议。