## 目标

* 将前端构建为可部署产物并上线测试/生产环境

* 配置真实 Supabase 后端并使新增/查询等操作持久化到数据库

* 保留“人情小精灵”助手能力，必要时增加服务端适配

## 部署方案

* 默认方案：Vercel（快速、支持 SPA 路由与环境变量）

* 备选方案：Netlify、Cloudflare Pages、Docker+Nginx（自托管）

## 后端准备（Supabase）

* 创建项目并获取 `VITE_SUPABASE_URL`、`VITE_SUPABASE_ANON_KEY`

* 建表与索引：

  * `contacts(id uuid pk, user_id uuid, name text, phone text, relationship text, notes text, metadata jsonb, created_at timestamptz, updated_at timestamptz)` 索引 `user_id,name`

  * `records(id uuid pk, user_id uuid, contact_id uuid fk, type text check in('gift_given','gift_received'), event_name text, event_date date, amount numeric, payment_method text, notes text, attachments jsonb, created_at timestamptz, updated_at timestamptz)` 索引 `user_id,event_date`

  * `categories(id uuid pk, user_id uuid, name text, type text check in('event','relationship'), color text, sort_order int, created_at timestamptz)` 索引 `user_id,type,sort_order`

* 开启 RLS 并添加策略：所有表 `auth.uid() = user_id` 的 select/insert/update/delete

* 验证：控制台手动插入 1–2 条记录，前端能读取

## 前端部署步骤（以 Vercel 为例）

* 代码安装与构建：

  * `npm ci`

  * `npm run build`（产物在 `dist/`）

* 配置项目：

  * 环境变量：在 Vercel Dashboard 添加 `VITE_SUPABASE_URL`、`VITE_SUPABASE_ANON_KEY`、可选 `VITE_APP_VERSION`

  * SPA 路由：自动使用单页应用回退，无需额外配置；如需显式：`vercel.json` 中添加 `{"rewrites":[{"source":"/(.*)","destination":"/index.html"}]}`

* 部署：连接 Git 仓库或直接导入，框架选择 Vite，Build 命令 `npm run build`，Output `dist`

* 验证：打开 Vercel 预览域名，测试登录→新增联系人→新增记录→列表与统计刷新

## 备选部署细节

* Netlify：Build `npm run build`，Publish `dist`；添加 `_redirects` 文件内容 `/* /index.html 200`；配置环境变量

* Cloudflare Pages：Build `npm run build`，Output `dist`；开启 SPA fallback；配置环境变量

* Docker+Nginx：镜像内拷贝 `dist`，Nginx 配置 `location / { try_files $uri /index.html; }`；通过环境注入在构建阶段设置 `VITE_*`

## 生产环境配置

* 禁用演示模式：提供有效的 Supabase URL/Key 后，前端自动切换至真实后端

* 观测与日志：可集成 Supabase Log/Policies 观测；前端错误通过 `react-hot-toast` 提示

* 安全：Anon Key 可暴露给前端；避免在日志中打印 Key；RLS 必须启用

* 版本与元信息：`VITE_APP_VERSION` 用于界面标注

## 智能体集成

* 现状：`/assistant` 已支持本地解析录入；在真实后端模式下将调用 `recordsAPI/contactsAPI`

* 若需外部智能体服务：新增 `ASSISTANT_API_URL` 与适配器；失败回退到本地解析器

## 验证与交付

* 预览环境链接（Vercel Preview）与生产域名

* 演示视频与截图：助手录入、列表刷新、导出/导入、错误态与空态

* 文档化：部署配置、环境变量列表、RLS 策略摘要

## 我将执行的具体操作

* 增加（或确认）SPA 重写配置并生成生产构建

* 在所选平台创建项目与环境变量，完成一次自动化部署

* 配置 Supabase 表结构与 RLS，回填连接信息，端到端验证

* 提供访问链接与验证报告

